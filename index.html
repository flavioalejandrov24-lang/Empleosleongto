<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Portal de empleos en Le√≥n, Guanajuato - Encuentra oportunidades laborales">
<title>Empleos Le√≥n GTO - Portal de Vacantes</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíº</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;overflow-x:hidden;color:#1a1a1a}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{transform:translateX(-100%)}to{transform:translateX(0)}}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes slideUp{from{opacity:0;transform:translateX(-50%) translateY(50px) scale(0.9)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.fade-in{animation:fadeIn .5s ease-out forwards}
.slide-in{animation:slideIn .3s ease-out forwards}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px}
.modal-window{background:white;border-radius:16px;box-shadow:0 25px 80px rgba(0,0,0,.4);max-width:500px;width:100%;overflow:hidden;border:1px solid rgba(255,255,255,.2);animation:fadeIn .3s ease-out}
.modal-header{background:linear-gradient(135deg,#000 0%,#333 100%);color:white;padding:24px;display:flex;align-items:center;gap:12px;font-weight:700;font-size:18px}
.modal-body{padding:28px;line-height:1.6;color:#495057}
.modal-footer{padding:20px 28px;background:#f8f9fa;display:flex;gap:12px;justify-content:flex-end;border-top:1px solid #e9ecef}
.btn{padding:12px 28px;border-radius:10px;font-weight:600;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);border:none;font-size:14px;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;justify-content:center;gap:8px}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;box-shadow:0 4px 14px rgba(102,126,234,.4)}
.btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 24px rgba(102,126,234,.5)}
.btn-new-vacancy{background:linear-gradient(135deg,#10b981 0%,#ffffff 100%);color:#065f46;box-shadow:0 4px 14px rgba(16,185,129,.4);font-weight:700;padding:10px 20px;border-radius:12px;white-space:nowrap}
.btn-new-vacancy:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 24px rgba(16,185,129,.5)}
@media (max-width:640px){.btn-new-vacancy{padding:8px 16px;font-size:12px}}
.btn-cancel{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:white;box-shadow:0 4px 14px rgba(220,53,69,.3);font-weight:700}
.btn-cancel:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(220,53,69,.4)}
.btn-outline{background:linear-gradient(135deg,white 0%,#f8f9fa 100%);border:2px solid #667eea;color:#667eea}
.btn-outline:hover:not(:disabled){background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
.btn-autofill{background:linear-gradient(135deg,#000 0%,#333 100%);color:#FFD700;box-shadow:0 4px 14px rgba(0,0,0,.4);border:2px solid rgba(255,215,0,.3)}
.btn-autofill:hover:not(:disabled){background:linear-gradient(135deg,#1a1a1a 0%,#444 100%);transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.5)}
.btn-clean{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);color:#667eea;border:2px solid #667eea}
.btn-clean:hover:not(:disabled){background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;transform:translateY(-2px)}
.btn-save{background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:white;box-shadow:0 4px 14px rgba(40,167,69,.3)}
.btn-save:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(40,167,69,.4)}
.input-group{position:relative;margin-bottom:20px}
.input-group input,.input-group textarea,.input-group select{width:100%;padding:14px 16px;border:2px solid #e9ecef;border-radius:10px;font-size:14px;transition:all .2s;font-family:inherit}
.input-group input:focus,.input-group textarea:focus,.input-group select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 4px rgba(102,126,234,.1)}
.input-group label{display:block;margin-bottom:8px;font-weight:600;color:#495057;font-size:13px;text-transform:uppercase;letter-spacing:.5px}
.input-icon{position:absolute;right:16px;top:42px;cursor:pointer;color:#6c757d;transition:color .2s;user-select:none}
.input-icon:hover{color:#667eea}
.vacancy-card{background:white;border-radius:24px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.1);transition:all .3s cubic-bezier(.4,0,.2,1);border:2px solid transparent}
.vacancy-card:hover{transform:translateY(-8px);box-shadow:0 20px 50px rgba(0,0,0,.2);border-color:rgba(102,126,234,.3)}
.loader{border:4px solid #f3f4f6;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin .8s linear infinite;margin:20px auto}
.line-clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ai-chat-modal{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:400px;max-height:600px;z-index:9999;animation:slideUp .4s ease-out;background:white;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.4);border:2px solid rgba(0,0,0,.2)}
.ai-chat-header{background:linear-gradient(135deg,#000 0%,#333 100%);color:#FFD700;padding:16px 20px;border-radius:16px 16px 0 0;display:flex;justify-content:space-between;align-items:center;cursor:move;font-weight:700;font-size:18px;text-shadow:0 0 10px rgba(255,215,0,.7)}
.ai-chat-header h3{margin:0;color:#FFD700}
.ai-chat-header .close-btn{background:rgba(255,255,255,.1);border:none;color:#FFD700;width:32px;height:32px;border-radius:50%;cursor:pointer;transition:all .3s ease;margin-left:12px}
.ai-chat-header .close-btn:hover{background:rgba(255,215,0,.2);transform:rotate(90deg)}
.ai-chat-messages{background:rgba(0,0,0,.95);padding:20px;max-height:300px;overflow-y:auto;border-left:2px solid #FFD700;border-right:2px solid #FFD700}
.ai-message{margin-bottom:16px;padding:12px 16px;border-radius:12px;max-width:90%;word-wrap:break-word;font-size:14px;line-height:1.5}
.ai-message.user{background:linear-gradient(135deg,#2563eb 0%,#3b82f6 100%);color:white;margin-left:auto;border-top-right-radius:4px}
.ai-message.bot{background:linear-gradient(135deg,#1a1a1a 0%,#333 100%);color:#FFD700;border-top-left-radius:4px;border-left:3px solid #FFD700}
.ai-loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,215,0,.3);border-top-color:#FFD700;border-radius:50%;animation:spin 1s linear infinite}
.ai-chat-input{background:linear-gradient(135deg,#000 0%,#333 100%);padding:16px;border-radius:0 0 16px 16px}
.ai-chat-input textarea{width:100%;padding:12px 16px;border:2px solid #FFD700;border-radius:12px;background:rgba(255,255,255,.1);color:white;resize:none;font-family:inherit;font-size:14px;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.2)}
.ai-chat-input textarea:focus{outline:none;border-color:#FFD700;box-shadow:0 0 15px rgba(255,215,0,.5)}
.ai-chat-input textarea::placeholder{color:rgba(255,255,255,.5)}
.ai-chat-actions{display:flex;gap:12px;margin-top:12px}
.ai-chat-actions button{flex:1;padding:12px 16px;border:none;border-radius:12px;font-weight:700;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px}
.ai-chat-actions .btn-send{background:linear-gradient(135deg,#1e3a8a 0%,#3b82f6 100%);color:white}
.ai-chat-actions .btn-send:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(59,130,246,.4)}
.ai-chat-actions .btn-start{background:linear-gradient(135deg,#16a34a 0%,#22c55e 100%);color:white;animation:pulse 2s infinite}
.ai-chat-actions .btn-start:hover:not(:disabled){transform:translateY(-2px) scale(1.05);box-shadow:0 8px 20px rgba(34,197,94,.4)}
.ai-chat-actions .btn-close-chat{background:linear-gradient(135deg,#dc3545 0%,#e83e8c 100%);color:white}
.ai-chat-actions .btn-close-chat:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px rgba(220,53,69,.4)}
.ai-chat-actions button:disabled{opacity:.5;cursor:not-allowed}
.ai-chat-input .file-upload{display:flex;align-items:center;gap:12px;margin-top:12px}
.ai-chat-input .file-upload label{background:rgba(255,215,0,.2);color:#FFD700;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:12px;transition:all .3s ease;border:1px solid rgba(255,215,0,.3)}
.ai-chat-input .file-upload label:hover{background:rgba(255,215,0,.3);transform:translateY(-1px)}
.ai-chat-input .file-upload input{display:none}
.ai-chat-input .file-preview{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.1);padding:8px 12px;border-radius:8px;margin-top:8px;border:1px solid rgba(255,215,0,.2)}
.ai-chat-input .file-preview img{width:40px;height:40px;object-fit:cover;border-radius:6px}
.ai-chat-input .file-preview .remove-file{background:rgba(255,0,0,.3);color:white;border:none;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:12px}
.ai-chat-modal.minimized{width:280px;height:60px;max-height:60px}
.ai-chat-modal.minimized .ai-chat-messages,.ai-chat-modal.minimized .ai-chat-input{display:none}
.ai-chat-modal.minimized .ai-chat-header{border-radius:16px}
.ai-chat-modal.minimized .ai-chat-header h3{font-size:14px}
::-webkit-scrollbar{width:12px}
::-webkit-scrollbar-track{background:#f1f1f1}
::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:6px}
textarea{box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.image-preview-container{width:100%;height:200px;overflow:hidden;border-radius:12px;position:relative}
.image-preview-container img{width:100%;height:100%;object-fit:cover;display:block}
.form-buttons-container{display:flex;flex-wrap:wrap;gap:12px}
@media (min-width:640px){.form-buttons-container{gap:16px}}
.btn-compact{padding:10px 16px;min-width:auto;display:inline-flex;align-items:center;justify-content:center;gap:6px;border-radius:12px;font-weight:600;transition:all 0.3s ease;backdrop-filter:blur(10px)}
.image-upload-area{border:2px dashed #d1d5db;border-radius:12px;padding:40px;text-align:center;background:#f9fafb;transition:all .3s ease;cursor:pointer}
.image-upload-area:hover{border-color:#667eea;background:#f3f4f6}
.image-upload-area.has-image{padding:0;border:none}
</style>
</head>
<body>
<div id="app"></div>
<div id="modal-root"></div>
<script>
console.log('üöÄ [INICIO] Cargando aplicaci√≥n Empleos Le√≥n GTO...');
// ==================== CONFIGURACI√ìN ====================
const SUPABASE_URL = 'https://mecrloufrzbfcihioeve.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lY3Jsb3VmcnpiZmNpaGlvZXZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTM2OTgsImV4cCI6MjA4NjMyOTY5OH0.Gs36EkNHv5vG2CPdrK7XtCnWvX5NYkyPY9moTdezbVA';
const SUPABASE_REDIRECT_URL = 'https://flavioalejandrov24-lang.github.io/empleosleongto/';
const { createClient } = supabase;
const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
console.log('‚úÖ [SUPABASE] Cliente inicializado');

// ==================== ESTADO GLOBAL ====================
let state = {
  view: 'login',
  user: null,
  isGuest: false,
  vacancies: [],
  editingVacancy: null,
  showPassword: false,
  showConfirmPassword: false,
  menuOpen: false,
  acceptedTerms: false,
  loading: false,
  imageUploading: false,
  formData: {
    email: '',
    password: '',
    confirmPassword: '',
    company: '',
    job_title: '',
    description: '',
    location: '',
    contact_phone: '',
    publication_date: '', // ‚úÖ Texto normal, no date
    schedule: '',
    work_days: '',
    imageBase64: ''
  },
  aiChatOpen: false,
  aiMessages: [],
  aiLoading: false,
  aiImage: null,
  aiImagePreview: null,
  aiExtractedData: null,
  chatMinimized: false
};

// Variables para drag and drop del chat IA (document-level, una sola vez)
let isDragging = false;
let offsetX = 0, offsetY = 0;
document.addEventListener('mousemove', (e) => {
  if (!isDragging) return;
  const chat = document.querySelector('.ai-chat-modal');
  if (!chat) return;
  const x = e.clientX - offsetX;
  const y = e.clientY - offsetY;
  const maxX = window.innerWidth - chat.offsetWidth;
  const maxY = window.innerHeight - chat.offsetHeight;
  const finalX = Math.max(0, Math.min(x, maxX));
  const finalY = Math.max(0, Math.min(y, maxY));
  chat.style.left = `${finalX}px`;
  chat.style.top = `${finalY}px`;
  chat.style.transform = 'none';
});
document.addEventListener('mouseup', () => {
  if (isDragging) {
    isDragging = false;
    const chat = document.querySelector('.ai-chat-modal');
    if (chat) chat.style.transition = 'all 0.3s ease';
  }
});

// Debouncer
let debounceTimers = {};
function debounce(key, func, delay = 300) {
  clearTimeout(debounceTimers[key]);
  debounceTimers[key] = setTimeout(func, delay);
}

// ==================== UTILIDADES ====================
const showLoading = () => {
  if (document.getElementById('loader-overlay')) return;
  state.loading = true;
  const loader = document.createElement('div');
  loader.id = 'loader-overlay';
  loader.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)';
  loader.innerHTML = '<div class="loader"></div>';
  document.body.appendChild(loader);
};

const hideLoading = () => {
  state.loading = false;
  const loader = document.getElementById('loader-overlay');
  if (loader) loader.remove();
};

const showModal = (type, title, message) => {
  document.querySelectorAll('#modal-root .modal-overlay').forEach(m => m.remove());
  const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };
  const colors = {
    success: 'linear-gradient(135deg,#28a745 0%,#20c997 100%)',
    error: 'linear-gradient(135deg,#dc3545 0%,#e83e8c 100%)',
    warning: 'linear-gradient(135deg,#ffc107 0%,#fd7e14 100%)',
    info: 'linear-gradient(135deg,#17a2b8 0%,#20c997 100%)'
  };
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal-window">
      <div class="modal-header" style="background:${colors[type]}">
        <span style="font-size:28px">${icons[type]}</span>
        <span>${escapeHtml(title)}</span>
      </div>
      <div class="modal-body"><p>${escapeHtml(message)}</p></div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-close-modal>
          <i class="fas fa-check"></i> Aceptar
        </button>
      </div>
    </div>
  `;
  document.getElementById('modal-root').appendChild(modal);
  modal.querySelector('[data-close-modal]').addEventListener('click', () => modal.remove());
  modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
  setTimeout(() => modal.remove(), 8000);
};

const escapeHtml = (text) => {
  if (typeof text !== 'string') return '';
  const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
  return text.replace(/[&<>"']/g, m => map[m]);
};

const convertImageToBase64 = (file) => {
  return new Promise((resolve, reject) => {
    if (state.imageUploading) return reject(new Error('Carga en progreso'));
    state.imageUploading = true;
    const reader = new FileReader();
    reader.onload = (e) => {
      state.imageUploading = false;
      resolve(e.target.result);
    };
    reader.onerror = () => {
      state.imageUploading = false;
      reject(new Error('Error al leer imagen'));
    };
    reader.readAsDataURL(file);
  });
};

const togglePasswordVisibility = (field) => {
  if (field === 'password') {
    state.showPassword = !state.showPassword;
    const input = document.getElementById('login-password') || document.getElementById('signup-password');
    const icon = document.getElementById('toggle-password');
    if (input) input.type = state.showPassword ? 'text' : 'password';
    if (icon) icon.innerHTML = `<i class="fas ${state.showPassword ? 'fa-eye-slash' : 'fa-eye'}"></i>`;
  } else {
    state.showConfirmPassword = !state.showConfirmPassword;
    const input = document.getElementById('signup-confirm-password');
    const icon = document.getElementById('toggle-confirm-password');
    if (input) input.type = state.showConfirmPassword ? 'text' : 'password';
    if (icon) icon.innerHTML = `<i class="fas ${state.showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'}"></i>`;
  }
};

// ==================== FUNCIONES PRINCIPALES ====================
// ... [TODAS LAS FUNCIONES DE AUTENTICACI√ìN, VACANTES, IA, FORMULARIO, RENDER, ETC. IGUALES AL C√ìDIGO ANTERIOR] ...
// SOLO CAMBIOS CR√çTICOS ABAJO:

// ‚úÖ CORREGIDO: startAutofill mapea fecha_publicacion ‚Üí publication_date
function startAutofill() {
  if (!state.aiExtractedData) {
    showModal('info', 'Sin datos', 'Primero env√≠a informaci√≥n para procesar.');
    return;
  }
  const data = state.aiExtractedData;
  if (data.company) state.formData.company = data.company;
  if (data.job_title) state.formData.job_title = data.job_title;
  if (data.description) state.formData.description = data.description;
  if (data.location) state.formData.location = data.location;
  if (data.contact_phone) state.formData.contact_phone = data.contact_phone;
  if (data.schedule) state.formData.schedule = data.schedule;
  if (data.work_days) state.formData.work_days = data.work_days;
  // ‚úÖ Mapeo correcto de fecha
  if (data.fecha_publicacion) state.formData.publication_date = data.fecha_publicacion;
  
  state.aiChatOpen = false;
  state.aiMessages = [];
  state.aiExtractedData = null;
  render();
  showModal('success', '¬°Formulario rellenado!', 'Revisa los campos y ajusta si es necesario antes de guardar. ‚ú®');
}

// ‚úÖ CORREGIDO: handleSaveVacancy usa publication_date y NO contact_email
async function handleSaveVacancy(e) {
  e.preventDefault();
  if (state.loading) return;
  
  if (!state.user || !state.user.id) {
    return showModal('error', 'Sesi√≥n requerida', 'Inicia sesi√≥n para publicar una vacante.');
  }
  if (!state.formData.imageBase64) {
    return showModal('error', 'Imagen requerida', 'Debes subir una imagen antes de guardar.');
  }
  
  showLoading();
  try {
    const vacancyData = {
      user_id: state.user.id,
      company: state.formData.company?.trim() || 'LA EMPRESA NO PROPORCIONA INFORMACI√ìN',
      job_title: state.formData.job_title?.trim() || 'LA EMPRESA NO PROPORCIONA INFORMACI√ìN',
      description: state.formData.description?.trim() || 'LA EMPRESA NO PROPORCIONA INFORMACI√ìN',
      location: state.formData.location?.trim() || 'Le√≥n, Guanajuato',
      contact_phone: state.formData.contact_phone?.trim() || null,
      publication_date: state.formData.publication_date?.trim() || null, // ‚úÖ Campo correcto
      schedule: state.formData.schedule?.trim() || null,
      work_days: state.formData.work_days?.trim() || null,
      image_base64: state.formData.imageBase64
    };
    
    let result;
    if (state.editingVacancy) {
      result = await supabaseClient
        .from('vacancies')
        .update(vacancyData)
        .eq('id', state.editingVacancy.id);
    } else {
      result = await supabaseClient
        .from('vacancies')
        .insert([vacancyData]);
    }
    
    if (result.error) throw result.error;
    
    state.editingVacancy = null;
    resetJobForm();
    clearAIData();
    await loadVacancies();
    state.view = 'dashboard';
    render();
    hideLoading();
    showModal('success', '¬°√âxito!', state.editingVacancy ? 'Vacante actualizada' : 'Vacante publicada');
  } catch (error) {
    console.error('‚ùå [SAVE] Error:', error);
    hideLoading();
    showModal('error', 'Error al guardar', error.message || 'No se pudo guardar');
  }
}

// ‚úÖ CORREGIDO: renderForm - publication_date es TEXT, no DATE
function renderForm() {
  return `
    <div class="min-h-screen py-8">
      <div class="max-w-3xl mx-auto px-4">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden fade-in">
          <div class="bg-gradient-to-br from-purple-600 to-purple-800 p-8 text-white">
            <h2 class="text-3xl font-black mb-2">${state.editingVacancy ? 'Editar Vacante' : 'Nueva Vacante'}</h2>
            <p class="text-purple-200">Completa la informaci√≥n de la vacante</p>
          </div>
          <form id="vacancy-form" class="p-8 space-y-6">
            <!-- Imagen -->
            <div class="input-group">
              <label>Imagen de la Vacante * (Obligatorio)</label>
              <div class="image-upload-area ${state.formData.imageBase64 ? 'has-image' : ''}">
                <input type="file" accept="image/*" id="image-upload" class="hidden">
                <label for="image-upload" class="cursor-pointer block">
                  ${state.formData.imageBase64 ? `
                    <div class="image-preview-container">
                      <img src="${escapeHtml(state.formData.imageBase64)}" alt="Vista previa">
                    </div>
                  ` : `
                    <div class="py-6">
                      <svg class="w-16 h-16 mx-auto text-purple-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                      </svg>
                      <p class="text-sm text-purple-600 font-semibold">Click para subir imagen</p>
                      <p class="text-xs text-gray-500 mt-1">M√°ximo 2MB ‚Ä¢ JPG, PNG</p>
                    </div>
                  `}
                </label>
              </div>
            </div>
            
            <!-- Campos principales -->
            <div class="input-group">
              <label>Empresa</label>
              <input type="text" placeholder="Ej: Calzado Le√≥n S.A." value="${escapeHtml(state.formData.company)}" id="input-company">
            </div>
            <div class="input-group">
              <label>Puesto</label>
              <input type="text" placeholder="Ej: Desarrollador Full Stack" value="${escapeHtml(state.formData.job_title)}" id="input-job-title">
            </div>
            <div class="input-group">
              <label>Descripci√≥n del Puesto</label>
              <textarea rows="5" placeholder="Describe las responsabilidades..." id="input-description">${escapeHtml(state.formData.description)}</textarea>
            </div>
            <div class="input-group">
              <label>Ubicaci√≥n</label>
              <input type="text" placeholder="Le√≥n, Guanajuato" value="${escapeHtml(state.formData.location)}" id="input-location">
            </div>
            
            <!-- Tel√©fono y Fecha (ambos texto) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="input-group">
                <label>Tel√©fono de Contacto</label>
                <input type="text" placeholder="Ej: 477-123-4567 o Llamar al..." value="${escapeHtml(state.formData.contact_phone)}" id="input-phone">
              </div>
              <div class="input-group">
                <label>Fecha de Publicaci√≥n</label>
                <input type="text" placeholder="Ej: 15/02/2024" value="${escapeHtml(state.formData.publication_date)}" id="input-publication-date">
              </div>
            </div>
            
            <!-- D√≠as y Horario -->
            <div class="input-group">
              <label>D√≠as de Trabajo</label>
              <textarea rows="2" placeholder="Ej: Lunes a Viernes" id="input-work-days">${escapeHtml(state.formData.work_days)}</textarea>
            </div>
            <div class="input-group">
              <label>Horario</label>
              <textarea rows="2" placeholder="Ej: 09:00 - 18:00 hrs" id="input-schedule">${escapeHtml(state.formData.schedule)}</textarea>
            </div>
            
            <!-- Botones -->
            <div class="form-buttons-container pt-4">
              <button type="button" id="cancel-form-btn" class="btn-compact btn-cancel w-full sm:flex-1">
                <i class="fas fa-times"></i> Cancelar
              </button>
              <button type="button" id="clean-form-btn" class="btn-compact btn-clean w-full sm:flex-1">
                <i class="fas fa-eraser"></i> Limpiar
              </button>
              <button type="button" id="toggle-ai-btn" class="btn-compact btn-autofill w-full sm:flex-1">
                <i class="fas fa-robot"></i> Autofill IA
              </button>
              <button type="submit" class="btn-compact btn-save w-full sm:flex-1" ${state.loading ? 'disabled' : ''}>
                ${state.loading ? '<i class="fas fa-spinner fa-spin"></i> Guardando...' : (state.editingVacancy ? '<i class="fas fa-edit"></i> Actualizar' : '<i class="fas fa-save"></i> Publicar')}
              </button>
            </div>
          </form>
        </div>
      </div>
      ${state.aiChatOpen ? renderAIChat() : ''}
    </div>
  `;
}

// ‚úÖ CORREGIDO: renderVacancyCard - elimina contacto_email, muestra publication_date
function renderVacancyCard(vacancy, isOwner) {
  return `
    <div class="vacancy-card">
      <div class="h-48 bg-gray-200 overflow-hidden">
        ${vacancy.image_base64 ? `
          <img src="${escapeHtml(vacancy.image_base64)}" alt="${escapeHtml(vacancy.company)}" class="w-full h-full object-cover">
        ` : `
          <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-400 to-purple-600">
            <i class="fas fa-image text-white text-6xl opacity-50"></i>
          </div>
        `}
      </div>
      <div class="p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-2 truncate">${escapeHtml(vacancy.company)}</h3>
        <p class="text-lg text-purple-600 font-semibold mb-3 truncate">${escapeHtml(vacancy.job_title)}</p>
        <p class="text-sm text-gray-600 mb-4 line-clamp-3">${escapeHtml(vacancy.description)}</p>
        <div class="space-y-2 mb-4">
          ${vacancy.location ? `
            <div class="flex items-start gap-2 text-sm text-gray-700">
              <i class="fas fa-map-marker-alt text-purple-600 mt-1"></i>
              <span>${escapeHtml(vacancy.location)}</span>
            </div>
          ` : ''}
          ${vacancy.contact_phone ? `
            <div class="flex items-start gap-2 text-sm text-gray-700">
              <i class="fas fa-phone text-purple-600 mt-1"></i>
              <span>${escapeHtml(vacancy.contact_phone)}</span>
            </div>
          ` : ''}
          ${vacancy.publication_date ? `
            <div class="flex items-start gap-2 text-sm text-gray-700">
              <i class="fas fa-calendar text-purple-600 mt-1"></i>
              <span>Publicado: ${escapeHtml(vacancy.publication_date)}</span>
            </div>
          ` : ''}
          ${vacancy.work_days ? `
            <div class="flex items-start gap-2 text-sm text-gray-700">
              <i class="fas fa-calendar-alt text-purple-600 mt-1"></i>
              <span>${escapeHtml(vacancy.work_days)}</span>
            </div>
          ` : ''}
          ${vacancy.schedule ? `
            <div class="flex items-start gap-2 text-sm text-gray-700">
              <i class="fas fa-clock text-purple-600 mt-1"></i>
              <span>${escapeHtml(vacancy.schedule)}</span>
            </div>
          ` : ''}
        </div>
        ${isOwner ? `
          <div class="flex gap-2 pt-4 border-t border-gray-200">
            <button data-edit-vacancy="${vacancy.id}" class="flex-1 btn btn-outline">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button data-delete-vacancy="${vacancy.id}" class="flex-1 btn btn-cancel">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        ` : ''}
      </div>
    </div>
  `;
}

// ... [RESTO DEL C√ìDIGO: attachEventListeners, init, etc. IGUALES] ...
// IMPORTANTE: En attachEventListeners, elimina el listener de input-email y agrega input-publication-date

function attachEventListeners() {
  // ... [LOGIN, SIGNUP, TERMS, DASHBOARD IGUALES] ...
  
  // FORM
  const vacancyForm = document.getElementById('vacancy-form');
  if (vacancyForm) {
    vacancyForm.addEventListener('submit', handleSaveVacancy);
    
    // ‚úÖ Prevenir m√∫ltiples listeners en imagen
    const imageUpload = document.getElementById('image-upload');
    if (imageUpload) {
      // Eliminar listeners previos si existen
      const newInput = imageUpload.cloneNode(true);
      imageUpload.parentNode.replaceChild(newInput, imageUpload);
      newInput.addEventListener('change', (e) => {
        if (!state.imageUploading) handleImageUpload(e);
      });
    }
    
    // ... [otros campos] ...
    
    // ‚úÖ publication_date como texto
    const inputPublicationDate = document.getElementById('input-publication-date');
    if (inputPublicationDate) {
      inputPublicationDate.addEventListener('input', (e) => {
        state.formData.publication_date = e.target.value;
      });
    }
    
    // ... [resto de listeners] ...
  }
  
  // ... [AI CHAT LISTENERS] ...
  
  // ‚úÖ Drag header del chat (solo si existe)
  const aiChatHeader = document.getElementById('ai-chat-header');
  if (aiChatHeader) {
    aiChatHeader.addEventListener('mousedown', (e) => {
      if (e.target.closest('.close-btn') || e.target.tagName === 'BUTTON') return;
      isDragging = true;
      const chat = document.querySelector('.ai-chat-modal');
      if (!chat) return;
      const rect = chat.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      chat.style.transition = 'none';
    });
  }
}

// ... [FUNCI√ìN INIT Y DEM√ÅS IGUALES] ...

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>
</body>
</html>
